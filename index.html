<!DOCTYPE html>
<html lang="es-PY">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Capacitaci√≥n: Cr√©ditos y Cobranzas</title>
    <style>
        :root {
            --color-primary: #8DB600;
            --color-primary-dark: #6a8a00;
            --color-text: #333333;
            --color-text-light: #666666;
            --color-background: #f9f9f9;
            --color-card: #ffffff;
            --color-border: #e0e0e0;
            --color-white: #ffffff;
            --color-header-inactive: #d3d3d3;
            --color-header-hover: #bfbfbf;
            --color-role-tag: #b5b5b5;
            --font-family-base: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            --spacing-sm: 8px;
            --spacing-md: 16px;
            --spacing-lg: 24px;
            --border-radius: 8px;
            --transition-speed: 0.3s;
        }
        *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
        html { scroll-behavior: smooth; }
        body { font-family: var(--font-family-base); background-color: var(--color-background); color: var(--color-text); line-height: 1.6; }
        .container { max-width: 900px; margin: 0 auto; padding: var(--spacing-lg); }
        header { background-color: var(--color-card); padding: var(--spacing-lg); border-radius: var(--border-radius); margin-bottom: var(--spacing-lg); box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1); }
        .header-top { display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: var(--spacing-md); }
        .title-block h1 { color: var(--color-primary-dark); font-size: 1.8rem; margin: 0; line-height: 1.1; }
        .title-block .subtitle { font-size: 1.5rem; color: var(--color-text); margin: 0; line-height: 1.2; font-weight: 600; }
        .version-info { font-size: 0.9rem; font-style: italic; color: var(--color-text-light); white-space: nowrap; margin-left: var(--spacing-md); }
        .controls { display: flex; flex-direction: column; gap: var(--spacing-md); }
        .search-wrapper, .anchor-nav { position: relative; }
        #search-input, #anchor-select { width: 100%; padding: 12px 12px 12px 40px; border: 1px solid var(--color-border); border-radius: var(--border-radius); font-size: 1rem; }
        .search-wrapper::before, .anchor-nav::before { position: absolute; left: 12px; top: 50%; transform: translateY(-50%); font-size: 1.2rem; opacity: 0.5; }
        .search-wrapper::before { content: 'üîç'; }
        .anchor-nav::before { content: '‚öì'; pointer-events: none; }
        #anchor-select { cursor: pointer; -webkit-appearance: none; appearance: none; background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='%23cccccc' viewBox='0 0 16 16'%3E%3Cpath fill-rule='evenodd' d='M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z'/%3E%3C/svg%3E"); background-repeat: no-repeat; background-position: right 12px center;}
        #filters { display: flex; flex-wrap: wrap; gap: var(--spacing-sm); justify-content: center; }
        .filter-btn { background-color: #f0f0f0; color: var(--color-text-light); border: 1px solid var(--color-border); padding: var(--spacing-sm) var(--spacing-md); border-radius: 20px; cursor: pointer; font-size: 0.9rem; transition: all var(--transition-speed); display: inline-flex; align-items: center; gap: var(--spacing-sm); }
        .filter-btn:hover { background-color: #cccccc; color: var(--color-text); }
        .filter-btn.active { background-color: var(--color-primary); color: var(--color-white); border-color: var(--color-primary-dark); font-weight: bold; }
        .icon { width: 18px; height: 18px; }
        .filter-btn.active .icon { filter: brightness(0) invert(1); }
        #scenarios-container { display: grid; gap: var(--spacing-md); }
        .scenario { background-color: var(--color-card); border: 1px solid var(--color-border); border-radius: var(--border-radius); overflow: hidden; }
        .scenario-header { padding: var(--spacing-md) var(--spacing-lg); cursor: pointer; display: flex; justify-content: space-between; align-items: center; gap: var(--spacing-md); transition: background-color var(--transition-speed); background-color: var(--color-header-inactive); }
        .scenario-header:hover { background-color: var(--color-header-hover); }
        .scenario-title { font-size: 1.1rem; font-weight: 600; flex-grow: 1; }
        .scenario-role { display: flex; align-items: center; gap: var(--spacing-sm); font-size: 0.9rem; color: var(--color-white); background-color: var(--color-role-tag); padding: 4px var(--spacing-sm); border-radius: 12px; white-space: nowrap; }
        .scenario-header::after { content: '‚ñº'; font-size: 0.8rem; transition: transform var(--transition-speed); color: var(--color-text-light); }
        .scenario.open > .scenario-header::after { transform: rotate(180deg); }
        .scenario-content { display: grid; grid-template-rows: 0fr; transition: grid-template-rows var(--transition-speed) ease-in-out; }
        .scenario.open > .scenario-content { grid-template-rows: 1fr; }
        .scenario-content-inner { overflow: hidden; padding: 0 var(--spacing-lg); }
        .scenario.open .scenario-content-inner { padding: var(--spacing-lg); border-top: 1px solid var(--color-border); }
        .situation { margin-bottom: var(--spacing-md); padding-left: var(--spacing-md); border-left: 3px solid var(--color-primary); }
        .situation h3, .solution h3 { font-size: 1rem; margin-bottom: var(--spacing-sm); color: var(--color-primary-dark); }
        .solution-toggle { background-color: var(--color-primary); color: var(--color-white); border: none; padding: 10px 15px; border-radius: var(--border-radius); cursor: pointer; font-size: 0.9rem; font-weight: bold; transition: background-color var(--transition-speed); margin-bottom: var(--spacing-md); }
        .solution-toggle:hover { background-color: var(--color-primary-dark); }
        .solution { background-color: rgba(141, 182, 0, 0.05); border: 1px solid rgba(141, 182, 0, 0.2); border-radius: var(--border-radius); padding: var(--spacing-md); }
        .solution ul { list-style-position: inside; padding-left: var(--spacing-sm); }
        .solution ul li { margin-bottom: var(--spacing-sm); }
        [hidden] { display: none !important; }
        .floating-actions { position: fixed; bottom: 20px; right: 20px; display: flex; flex-direction: column; gap: var(--spacing-md); z-index: 110; }
        .fab { background-color: var(--color-primary); color: white; border: none; border-radius: 50%; width: 50px; height: 50px; cursor: pointer; box-shadow: 0 4px 8px rgba(0,0,0,0.2); display: grid; place-items: center; transition: opacity 0.3s, transform 0.3s; opacity: 0; transform: scale(0.8); pointer-events: none; }
        .fab.visible { opacity: 1; transform: scale(1); pointer-events: auto; }
        .fab:hover { background-color: var(--color-primary-dark); transform: scale(1.05); }
        @media (max-width: 600px) { .header-top { flex-direction: column; align-items: flex-start; } .scenario-header { flex-direction: column; align-items: flex-start; } }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="header-top">
                <div class="title-block">
                    <h1>Cr√©ditos y Cobranzas</h1>
                    <p class="subtitle">Manual de Entrenamiento</p>
                </div>
                <span class="version-info">PG-CC-0X Ver 01</span>
            </div>
            <div class="controls">
                <div class="search-wrapper"><input type="search" id="search-input" placeholder="Buscar por palabra clave..."></div>
                <div class="anchor-nav"><select id="anchor-select"></select></div>
                <div id="filters"></div>
            </div>
        </header>
        <main id="scenarios-container"></main>
    </div>
    <div class="floating-actions">
        <button id="close-all-btn" class="fab" title="Cerrar todos los escenarios"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path></svg></button>
        <button id="back-to-top" class="fab" title="Volver arriba"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 19V5M5 12l7-7 7 7"/></svg></button>
    </div>
    <script>
    // √öNICA SECCI√ìN A MODIFICAR: Reemplaza el contenido de este array con los datos del nuevo documento.
    const scenarios = [
        {
            "id": 1,
            "title": "El Olvidadizo Recurrente",
            "roles": ["Auxiliar de CyC"],
            "situation": "Cliente con 15 d√≠as de atraso. El Auxiliar llama y el cliente responde: 'Ah, no me lleg√≥ la factura, m√°ndamela y veo si pago la pr√≥xima semana'. El Auxiliar corta, env√≠a el correo y marca 'Gestionado' en el sistema, agendando la pr√≥xima llamada para dentro de 10 d√≠as.",
            "solution": "El auxiliar debe enviar la factura en el momento y confirmar recepci√≥n en l√≠nea, recordando que al d√≠a 30 se bloquear√° la l√≠nea de cr√©dito autom√°ticamente (TB-CC-02). No se debe esperar 'a la pr√≥xima semana' sin una promesa de pago registrada en el sistema."
        },
        {
            "id": 2,
            "title": "La Promesa del Viernes",
            "roles": ["Cobrador"],
            "situation": "Cliente promete pagar el viernes. Llega el lunes y no hay pago. El cobrador no llama porque 'seguro se olvid√≥, le doy un d√≠a m√°s'.",
            "solution": "Violaci√≥n del protocolo de seguimiento. Seg√∫n PG-CC-02, toda promesa incumplida requiere gesti√≥n inmediata. Si se pact√≥ una fecha y no se cumpli√≥, la llamada debe ser el d√≠a h√°bil inmediatamente siguiente."
        },
        {
            "id": 3,
            "title": "El Bloqueo Sorpresa",
            "roles": ["Cobrador"],
            "situation": "Cliente llama furioso el d√≠a 31: '¬°No puedo facturar, me bloquearon el sistema!'. El cobrador responde: 'Voy a pedir autorizaci√≥n para desbloquearle moment√°neamente as√≠ puede trabajar'.",
            "solution": "El bloqueo a los 30 d√≠as es autom√°tico por pol√≠tica. El cobrador no tiene facultad para desbloquear sin pago o refinanciaci√≥n. La respuesta correcta es gestionar el pago inmediato para habilitar la l√≠nea."
        },
        {
            "id": 4,
            "title": "Pago Parcial T√°ctico",
            "roles": ["Cobrador"],
            "situation": "Cliente debe 10.000.000 Gs (vencido hace 45 d√≠as). Transfiere 5.000.000 Gs y dice: 'Con esto ya estoy al d√≠a, el resto veo el mes que viene'.",
            "solution": "El cobrador debe imputar el pago priorizando intereses moratorios (Paso 1.2.3.2). Debe aclarar al cliente que el pago parcial no levanta el bloqueo ni detiene la mora del saldo restante."
        },
        {
            "id": 5,
            "title": "La Trampa de los Intereses",
            "roles": ["Jefe de CyC"],
            "situation": "Cliente 'Amigo de la casa' pide refinanciar su deuda de 6 meses en 12 cuotas, pero exige: 'Qu√≠tame los intereses, soy cliente antiguo'. El Jefe de CyC accede para cerrar el trato r√°pido.",
            "solution": "El Paso 1.1 del PG-CC-03 exige considerar el 'Total de la deuda, incluyendo los intereses'. La condonaci√≥n de intereses es una excepci√≥n financiera que requiere aprobaci√≥n superior (Gerencia) seg√∫n la Pol√≠tica de Cr√©ditos."
        },
        {
            "id": 6,
            "title": "Refinanciaci√≥n Fantasma (Sin Pagar√©s)",
            "roles": ["Cobrador"],
            "situation": "Se acuerda la refinanciaci√≥n por correo. El cliente env√≠a la primera cuota por transferencia. El cobrador activa el plan en sistema pero olvida gestionar la firma f√≠sica de los nuevos pagar√©s.",
            "solution": "Error fatal. El Paso 2.7 y 2.11 exigen la preparaci√≥n y firma del 'Acuerdo de refinanciaci√≥n y Pagar√©s'. Sin estos documentos f√≠sicos archivados, la nueva deuda es incobrable judicialmente."
        },
        {
            "id": 7,
            "title": "El Cheque Rechazado Oculto",
            "roles": ["Cobrador"],
            "situation": "Al refinanciar, el cobrador suma todas las facturas vencidas, pero olvida incluir un cheque rechazado de hace 3 meses que estaba en la caja fuerte, no en la cuenta corriente visible del sistema.",
            "solution": "El Paso 2.7 especifica expl√≠citamente: 'Para los cheques rechazados, se debe incluir en el monto del acuerdo y pagar√©s'. El cobrador debe revisar el f√≠sico o el reporte de valores rechazados antes de cotizar."
        },
        {
            "id": 8,
            "title": "El L√≠mite de Autoridad (160MM)",
            "roles": ["Jefe de CyC"],
            "situation": "Un cliente corporativo grande pide una l√≠nea de cr√©dito de 160.000.000 Gs. El Jefe de Cr√©ditos y Cobranzas, viendo que tiene balances excelentes, aprueba la carpeta solo.",
            "solution": "Violaci√≥n de Pol√≠tica. El l√≠mite del Jefe es Hasta 150mm. Esta operaci√≥n deb√≠a ir obligatoriamente a firma del Gerente General."
        },
        {
            "id": 9,
            "title": "La Factura del 2023 (Error de Sistema)",
            "roles": ["Cobrador"],
            "situation": "Viernes por la tarde. Se intenta refinanciar una factura de Noviembre 2023. El cobrador intenta generar la Nota de Cr√©dito en Ping y el sistema da error 'Documento no encontrado'.",
            "solution": "No es error de sistema, es procedimiento. El cobrador debi√≥ seguir el Paso 1.4: solicitar al Jefe de Contabilidad que instruya a TI para dar de alta la factura hist√≥rica en Ping antes de intentar la operaci√≥n."
        },
        {
            "id": 10,
            "title": "Garant√≠a Prendaria Ignorada",
            "roles": ["Cobrador"],
            "situation": "Se refinancia una deuda de venta de maquinaria pesada. El cliente est√° muy endeudado. El cobrador hace un plan de pagos simple solo con firma de pagar√©s.",
            "solution": "El Paso 1.1 indica: 'En el caso de que el cliente tenga un equipo evaluar incluirlo como garant√≠a prendaria del acuerdo'. Omitir esto deja a la empresa desprotegida ante una quiebra del cliente."
        },
        {
            "id": 11,
            "title": "Pagu√©, ¬°Desbloqu√©ame YA!",
            "roles": ["Cobrador"],
            "situation": "Cliente paga a las 18:00 PM y env√≠a el comprobante al WhatsApp del cobrador. El cobrador lo ve, registra el cobro en Inventiva y se va a su casa. A las 20:00 PM el cliente llama insultando porque la m√°quina sigue parada.",
            "solution": "El cobro administrativo no desbloquea la m√°quina autom√°ticamente. El Paso 1.2.3.5 exige informar al Servicio T√©cnico (v√≠a correo) para la habilitaci√≥n t√©cnica. El cobrador olvid√≥ el paso final cr√≠tico."
        },
        {
            "id": 12,
            "title": "El Cliente Inubicable (Codeudor)",
            "roles": ["Cobrador"],
            "situation": "El titular de la deuda no contesta llamadas ni mensajes hace 20 d√≠as. El cobrador deja de llamar esperando que 'aparezca'.",
            "solution": "La nota en TB-CC-02 dice: 'En caso de imposibilidad de contactar con el titular... se debe contactar con los codeudores'. El cobrador debe activar la presi√≥n sobre los garantes solidarios inmediatamente."
        },
        {
            "id": 13,
            "title": "Caja Cerrada vs. Refinanciaci√≥n",
            "roles": ["Cobrador"],
            "situation": "Se cierra una refinanciaci√≥n el √∫ltimo d√≠a del mes. El cobrador decide emitir la Nota de Cr√©dito (anulaci√≥n deuda vieja) hoy, pero facturar el nuevo acuerdo el d√≠a 1 del mes siguiente.",
            "solution": "Prohibido. El Paso 2.1 exige que 'las facturas se deben dar de baja con notas de cr√©dito emitidas el mismo mes en que se realizar√° la refacturaci√≥n'. Deben quedar calzadas fiscalmente."
        },
        {
            "id": 14,
            "title": "Cheque con Endoso Incorrecto",
            "roles": ["Cobrador"],
            "situation": "Cliente trae un cheque de un tercero para pagar su cuenta. El cheque tiene un error en el nombre y est√° salvado atr√°s con un 'Digo: [Nombre Correcto]' y nueva firma.",
            "solution": "Rechazo inmediato. La pol√≠tica proh√≠be cheques 'Endosados por correcci√≥n'. El cobrador debe rechazar el valor para evitar un rebote bancario seguro."
        },
        {
            "id": 15,
            "title": "Pr√≥rroga no Autorizada",
            "roles": ["Auxiliar de CyC"],
            "situation": "Cliente pide pagar su cuota vencida (d√≠a 45) dentro de 20 d√≠as m√°s. El Auxiliar le dice 'Ok, anoto en el sistema'.",
            "solution": "El Auxiliar no tiene esa potestad. El Paso 1.2.3.4 indica que pedidos que superen los rangos de la TB-CC-02 deben ser aprobados por Gerencia Administrativa Financiera."
        },
        {
            "id": 16,
            "title": "La Amenaza Prematura",
            "roles": ["Cobrador"],
            "situation": "Cliente con 40 d√≠as de atraso. El cobrador, frustrado, le grita: '¬°Si no paga ma√±ana le metemos en Informconf y le demandamos!'.",
            "solution": "Mala praxis y riesgo legal. Informconf es a los 91 d√≠as (TB-CC-02). Amenazar con plazos falsos viola la √©tica de cobranza y puede generar denuncias en Defensa al Consumidor."
        },
        {
            "id": 17,
            "title": "El Abogado Impaciente",
            "roles": ["Jefe de CyC"],
            "situation": "El Jefe de CyC tiene una carpeta lista para juicio (180 d√≠as de mora). Conoce al abogado externo y le entrega los pagar√©s originales para 'ir ganando tiempo' mientras el Gerente vuelve de viaje.",
            "solution": "Falta Grave. El Paso 1.1.2 establece que es el Gerente General quien autoriza el recupero judicial. Entregar t√≠tulos de cr√©dito originales a terceros sin esa firma es causal de sanci√≥n."
        },
        {
            "id": 18,
            "title": "El Arrepentido Judicial",
            "roles": ["Cobrador"],
            "situation": "La cuenta ya est√° en demanda. El cliente se asusta y viene a la oficina queriendo pagar todo. El cobrador cobra en caja normalmente y le da su recibo.",
            "solution": "Error de procedimiento. Si est√° en demanda, se debe procesar seg√∫n PG-CC-03 (Refinanciaci√≥n), lo que implica calcular honorarios de abogados y gastos judiciales ANTES de aceptar el pago (Paso 2.8 del PG-CC-03). Cobrar solo capital deja a la empresa pagando los costos del juicio."
        },
        {
            "id": 19,
            "title": "Inhibici√≥n Vencida",
            "roles": ["Cobrador", "Asesor de Ventas"],
            "situation": "Un cliente fue inhibido hace 6 a√±os. Ahora quiere comprar al contado. El sistema muestra 'Inhibido'. El vendedor dice: 'Ya pasaron 5 a√±os, ya caduc√≥, vendamos'.",
            "solution": "El cobrador debe verificar si se renov√≥ la inhibici√≥n. El procedimiento indica que las inhibiciones duran 5 a√±os pero pueden renovarse hasta 3 veces. Se debe consultar al abogado antes de liberar al cliente."
        },
        {
            "id": 20,
            "title": "Solicitud de Cr√©dito Incompleta",
            "roles": ["Asesor de Ventas"],
            "situation": "Vendedor trae una Solicitud REV06 para un cliente nuevo. Trae copia de c√©dula y RUC, pero falta el 'Croquis' y la factura de servicio p√∫blico. '√âl es conocido, vive ac√° a la vuelta', dice el vendedor.",
            "solution": "Rechazo en Fase de An√°lisis (Paso 1.2.2). La verificaci√≥n de domicilio (estabilidad) es obligatoria. 'Ser conocido' no es un criterio de riesgo v√°lido en la pol√≠tica escrita. Se devuelve el legajo al Asesor de Ventas."
        }
    ];

    // NO MODIFICAR EL C√ìDIGO DEBAJO DE ESTA L√çNEA
    document.addEventListener('DOMContentLoaded', () => {
        const scenariosContainer = document.getElementById('scenarios-container');
        const searchInput = document.getElementById('search-input');
        const filtersContainer = document.getElementById('filters');
        const anchorSelect = document.getElementById('anchor-select');
        const backToTopButton = document.getElementById('back-to-top');
        const closeAllButton = document.getElementById('close-all-btn');
        let activeFilter = 'Todos';
        const SESSION_STORAGE_KEY = 'openScenarios';
        const icons = {
            "Asesor de Ventas": `<svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg>`,
            "Encargado de Dep√≥sito": `<svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M20 8h-3V4H7v4H4c-1.1 0-2 .9-2 2v10h20V10c0-1.1-.9-2-2-2zM9 6h6v2H9V6zm11 12H4v-3h2v1h2v-1h8v1h2v-1h2v3zm-5-5H8v-2h8v2z"/></svg>`,
            "Cajero/a": `<svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M19 18H5V8h14v10zM5 6a2 2 0 00-2 2v10a2 2 0 002 2h14a2 2 0 002-2V8a2 2 0 00-2-2H5zm-1-2h16v2H4V4zm4 4h8v2H8V8zm0 3h8v2H8v-2z"/></svg>`,
            "Delivery": `<svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M20 8h-3V4H3c-1.1 0-2 .9-2 2v11h2c0 1.66 1.34 3 3 3s3-1.34 3-3h6c0 1.66 1.34 3 3 3s3-1.34 3-3h2V8zM6 18c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1zm12 0c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1zM18 11H3V6h11v5h4v0z"/></svg>`,
        };
        const getIconForRole = (role) => icons[role] || '';
        const renderScenarios = (scenariosToRender) => {
            scenariosContainer.innerHTML = '';
            scenariosToRender.forEach(s => {
                const scenarioEl = document.createElement('article');
                scenarioEl.className = 'scenario';
                scenarioEl.dataset.id = s.id;
                scenarioEl.id = `escenario-${s.id}`;
                scenarioEl.innerHTML = `
                    <header class="scenario-header" role="button" aria-expanded="false"><h2 class="scenario-title">${s.id}: ${s.title}</h2><div class="roles-wrapper">${s.roles.map(r => `<span class="scenario-role">${getIconForRole(r)}${r}</span>`).join('')}</div></header>
                    <div class="scenario-content">
                        <div class="scenario-content-inner">
                            <div class="situation"><h3>Situaci√≥n</h3><p>${s.situation}</p></div>
                            <button class="solution-toggle" aria-expanded="false">Ver Soluci√≥n Recomendada</button>
                            <div class="solution" hidden><h3>Soluci√≥n Recomendada</h3><ul>${s.solution.split('\n').map(l => `<li>${l}</li>`).join('')}</ul></div>
                        </div>
                    </div>`;
                scenariosContainer.appendChild(scenarioEl);
            });
        };
        const renderFilters = () => {
            const allRoles = [...new Set(scenarios.flatMap(s => s.roles))];
            let filtersHtml = `<button class="filter-btn active" data-role="Todos">Todos</button>`;
            allRoles.sort().forEach(role => { filtersHtml += `<button class="filter-btn" data-role="${role}">${getIconForRole(role)}${role}</button>`; });
            filtersContainer.innerHTML = filtersHtml;
        };
        const renderAnchorNav = () => {
            anchorSelect.innerHTML = '<option value="">Saltar a un escenario...</option>';
            scenarios.forEach(s => { const o = document.createElement('option'); o.value = s.id; o.textContent = `${s.id}: ${s.title}`; anchorSelect.appendChild(o); });
        };
        const filterAndSearch = () => {
            const searchTerm = searchInput.value.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "");
            let filtered = scenarios.filter(s => activeFilter === 'Todos' || s.roles.includes(activeFilter));
            if (searchTerm) {
                filtered = filtered.filter(s => Object.values(s).join(' ').toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "").includes(searchTerm));
            }
            renderScenarios(filtered);
            loadState();
        };
        const saveState = () => { sessionStorage.setItem(SESSION_STORAGE_KEY, JSON.stringify(Array.from(document.querySelectorAll('.scenario.open')).map(el => el.dataset.id))); };
        const loadState = () => { JSON.parse(sessionStorage.getItem(SESSION_STORAGE_KEY) || '[]').forEach(id => { const el = document.querySelector(`.scenario[data-id='${id}']`); if (el) { el.classList.add('open'); el.querySelector('.scenario-header').setAttribute('aria-expanded', 'true'); } }); };
        filtersContainer.addEventListener('click', e => { if (e.target.closest('.filter-btn')) { filtersContainer.querySelector('.active').classList.remove('active'); e.target.closest('.filter-btn').classList.add('active'); activeFilter = e.target.closest('.filter-btn').dataset.role; filterAndSearch(); } });
        anchorSelect.addEventListener('change', e => { if (e.target.value) { const target = document.getElementById(`escenario-${e.target.value}`); if (target) { if (!target.classList.contains('open')) { target.querySelector('.scenario-header').click(); } target.scrollIntoView({ behavior: 'smooth', block: 'center' }); } e.target.selectedIndex = 0; } });
        closeAllButton.addEventListener('click', () => { document.querySelectorAll('.scenario.open').forEach(s => { s.classList.remove('open'); s.querySelector('.scenario-header').setAttribute('aria-expanded', 'false'); }); sessionStorage.removeItem(SESSION_STORAGE_KEY); });
        scenariosContainer.addEventListener('click', e => { const header = e.target.closest('.scenario-header'); if (header) { const s = header.parentElement; s.classList.toggle('open'); header.setAttribute('aria-expanded', s.classList.contains('open')); saveState(); } const solToggle = e.target.closest('.solution-toggle'); if (solToggle) { const solDiv = solToggle.nextElementSibling; const isExp = solToggle.getAttribute('aria-expanded') === 'true'; solToggle.setAttribute('aria-expanded', !isExp); solDiv.hidden = isExp; solToggle.textContent = isExp ? 'Ver Soluci√≥n' : 'Ocultar Soluci√≥n'; } });
        const checkScroll = () => { backToTopButton.classList.toggle('visible', document.documentElement.scrollTop > 100); closeAllButton.classList.toggle('visible', document.querySelector('.scenario.open') !== null); };
        window.addEventListener('scroll', checkScroll);
        scenariosContainer.addEventListener('click', () => setTimeout(checkScroll, 350));
        closeAllButton.addEventListener('click', () => setTimeout(checkScroll, 350));
        backToTopButton.addEventListener('click', () => window.scrollTo({ top: 0, behavior: 'smooth' }));
        renderFilters(); renderAnchorNav(); renderScenarios(scenarios); loadState(); checkScroll();
    });
    </script>
</body>
</html>
